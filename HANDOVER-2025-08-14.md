# Many Futures MVP - Development Handover Document
**Date:** 2025-08-14  
**Session:** Day 6 of 14-day MVP Build  
**Status:** In Active Development  

## 🎯 Project Overview

Many Futures is an **agentic foresight assistant** that delivers personalized, AI-powered strategic intelligence weekly. We're building a lean MVP to validate the core hypothesis: **Will businesses pay for AI-generated strategic intelligence?**

### Current Build Target
- **Timeline:** 14-day MVP (Day 6 complete)
- **Goal:** 5 paying customers at £29/month
- **Stack:** T3 (Next.js 15, TypeScript, Tailwind v4, Drizzle ORM)
- **Deployment:** Vercel (with root directory set to `many-futures`)

## 📊 Current Development Status

### ✅ Completed Work (Day 1-6)

#### Infrastructure & Setup
- [x] Migrated from next-forge to T3 stack for simplicity
- [x] Deployed to Vercel with proper root directory configuration
- [x] Set up shadcn/ui with stone theme
- [x] Created comprehensive mock data structure with organizations
- [x] Implemented unified editorial design system (The Economist meets Substack)

#### Core UI Implementation
- [x] **Dashboard Layout** - Context-aware navigation (minimal for reading, full for lists)
- [x] **Projects Page** - Grid layout with serif typography, active/paused status
- [x] **Project Detail Page** - Three-zone layout (editorial hero, functional content, metadata)
- [x] **Episode Reader** - Beautiful reading experience with serif fonts
- [x] **Homepage** - Redirect to /projects (no auth yet)

#### Conversational UI (Major Achievement - Day 6)
- [x] **GPT-5 API Integration** - Set up with fallback to GPT-4o-mini
- [x] **Minimal Centered Design** - Ported from prototype with fade animations
- [x] **FuturaAvatar Component** - Animated purple gradient orb
- [x] **BriefCanvas Component** - ContentEditable with typewriter effect
- [x] **Conversation State Management** - Custom hook with phase tracking
- [x] **First Principles Prompting** - Eliminates "all of it" clarification loops
- [x] **Keyboard Shortcuts** - Tab to edit, Enter to confirm, Esc to exit

#### Database Schema Planning
- [x] **Comprehensive Schema Documentation** (`/src/lib/database-schema.ts`)
- [x] **Critical Security Fixes** from advisor feedback:
  - Added OrganizationMember junction table
  - Removed dangerous dailyTotal field from TokenUsage
  - Added Subscription table for Stripe integration
  - Added audit trail fields (deletedAt, deletedBy)
  - Added provider field to TokenUsage
- [x] **Organization Scoping** - All data properly scoped for multi-tenancy

#### TypeScript & Code Quality
- [x] Strict mode TypeScript patterns documented
- [x] CLAUDE.md files in key directories with patterns
- [x] Pre-commit checklist (typecheck, build, format)
- [x] Consistent use of nullish coalescing over logical OR

### 🚧 In Progress / Known Issues

#### CRITICAL BUG TO FIX
```
GET http://localhost:3000/projects/proj_1 500 (Internal Server Error)
```
- **Location:** Project detail page (`/projects/[id]`)
- **Impact:** Breaks individual project viewing
- **Likely cause:** Issue with Next.js 15 params as Promise pattern
- **Investigation needed:** Check the `use()` hook implementation

#### Database Schema Refinement
- **Status:** Schema is documented but NOT implemented
- **File:** `/src/lib/database-schema.ts` (WORKING DOCUMENT)
- **Next steps:** 
  - Continue refining based on implementation needs
  - Prepare for Supabase integration
  - Ensure all security considerations are addressed

#### Conversational UI Testing
- **Status:** Implementation complete but needs real-world testing
- **Areas to test:**
  - API key configuration (currently optional for builds)
  - Brief generation with actual GPT-4o-mini responses
  - Edge cases in conversation flow
  - Token usage tracking integration

### 📝 Pending Tasks (from MVP Build Plan)

#### Day 3 Tasks (Outstanding)
- [ ] **Analytics Setup** - Vercel Analytics integration
- [ ] **Episode Scheduling** - Cron job for weekly generation
- [ ] **Cost Control** - £50/day kill switch implementation

#### Day 4-5 Tasks (Not Started)
- [ ] **Database Setup** - Supabase integration
- [ ] **Authentication** - Clerk integration
- [ ] **Payment System** - Stripe integration
- [ ] **Episode Generation** - n8n workflow integration

## 🏗️ Technical Architecture

### File Structure
```
many-futures/
├── src/
│   ├── app/
│   │   ├── (dashboard)/        # Authenticated routes
│   │   │   ├── layout.tsx      # Context-aware navigation
│   │   │   ├── projects/       # Projects list & detail
│   │   │   │   ├── new/        # Conversational UI ⭐ NEW
│   │   │   │   └── [id]/       # Project detail (500 ERROR)
│   │   │   └── episodes/       # Episode reader
│   │   └── api/
│   │       └── project-conversation/  # GPT-5/4 integration ⭐ NEW
│   ├── components/
│   │   ├── brand/              # FuturaAvatar ⭐ NEW
│   │   ├── project/            # BriefCanvas ⭐ NEW
│   │   └── ui/                 # shadcn components
│   ├── hooks/
│   │   └── useProjectConversation.ts  # ⭐ NEW
│   └── lib/
│       ├── mock-data.ts        # Current data model
│       ├── mock-episodes.ts    # Episode content
│       └── database-schema.ts  # 🚧 WORKING DOCUMENT
```

### Key Integration Points

#### OpenAI API
- **Current:** GPT-4o-mini (working)
- **Future:** GPT-5-mini with Responses API
- **Critical distinction:** `input` param for messages, `instructions` for prompts
- **Environment:** `OPENAI_API_KEY` (optional for builds)

#### Mock Data Structure
- Organizations mandatory from day 1
- Projects belong to organizations
- Episodes denormalized with organizationId
- Token usage tracked per organization

## 🔧 Development Environment

### Local Setup
```bash
cd many-futures
pnpm install
pnpm dev        # http://localhost:3000
```

### Critical Commands
```bash
pnpm typecheck  # Must pass before commit
pnpm build      # Must succeed before deploy
pnpm check:write # Format with Biome
```

### Environment Variables Needed
```env
# .env.local
OPENAI_API_KEY=sk-...  # For conversational UI

# Future requirements
DATABASE_URL=           # Supabase
CLERK_SECRET_KEY=       # Auth
STRIPE_SECRET_KEY=      # Payments
```

## 🐛 Debug Priority

### 1. Fix 500 Error on Project Detail Page
```typescript
// Check /app/(dashboard)/projects/[id]/page.tsx
// Issue with Next.js 15 params handling
export default function ProjectDetailPage({ params }: { params: Promise<{ id: string }> }) {
  const { id } = use(params);  // Check this implementation
  // ...
}
```

### 2. Test Conversational UI End-to-End
- Add OPENAI_API_KEY to environment
- Test full conversation flow
- Verify brief generation
- Check error handling

### 3. Continue Schema Refinement
- Review `/src/lib/database-schema.ts`
- Prepare migration strategy
- Plan Supabase table creation

## 📚 Key Documentation

### Internal Docs
- `/CLAUDE.md` - Main project context and rules
- `/docs/02 Areas/Product-Specification/` - PRDs and ADRs
- `/docs/03 Resources/many-futures-prototype-v4/` - Prototype reference
- `/src/lib/database-schema.ts` - Database planning (WORKING DOC)

### External Resources
- [GPT-5 Documentation](/docs/03 Resources/Documentation/open-ai-gpt-5-docs.md)
- [ADR-012: New Project Creation Architecture](./docs/02 Areas/Product-Specification/05-architecture-decisions/12-new-project-creation-architecture.md)
- [ADR-013: GPT-5 Migration](./docs/02 Areas/Product-Specification/05-architecture-decisions/13-gpt5-migration.md)

## 🎯 Next Session Priorities

1. **FIX:** 500 error on `/projects/[id]` page
2. **TEST:** Conversational UI with real API key
3. **REFINE:** Database schema based on testing
4. **IMPLEMENT:** Token usage tracking in API route
5. **PLAN:** Supabase integration approach

## 💡 Important Context for Next Session

### Design Philosophy
- **Editorial over functional** - Beautiful reading experience is priority
- **Serif typography** - Lora for headings, reading content
- **Minimal navigation** - Auto-hides on scroll for reading pages
- **White backgrounds** - Not stone-50, pure white for reading

### Conversation UI Learnings
- **Synthesis over clarification** - Handle "all of it" responses
- **2-3 turn conversations** - Then offer brief creation
- **Phase-based progress** - Not rigid turn counting
- **Natural language** - No consultant jargon

### Security Considerations
- **Organization scoping** - EVERY query must filter by orgId
- **Cost controls** - £2/episode, £50/day limits
- **Soft deletes** - Never hard delete, use deletedAt field
- **Audit trails** - Track who deleted what

## 📈 Progress Metrics

- **Days Elapsed:** 6 of 14
- **Completion:** ~40% of MVP features
- **Major Wins:** UI scaffold complete, conversational UI working
- **Major Risks:** Database integration timeline, payment system complexity

## 🚀 Deployment Status

- **Production URL:** Deployed to Vercel
- **Build Status:** ✅ Passing
- **TypeScript:** ✅ No errors
- **Known Issues:** Project detail 500 error

---

**Last Commit:** `d0ff33e` - feat: Implement conversational UI for project creation  
**Session End:** 2025-08-14 (Day 6 Complete)  
**Next Session:** Continue with bug fixes and testing

---

*This handover document captures the complete state of the Many Futures MVP as of Day 6. The conversational UI is the major achievement, but testing and refinement are needed. The database schema remains a working document that should continue to evolve based on implementation needs.*